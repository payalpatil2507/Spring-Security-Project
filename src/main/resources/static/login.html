<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document Signing</title>
    <link rel="preload" href="fonts.gstatic.com" as="font" type="font/com" fetchpriority="high" crossorigin="anonymous">
    <link rel="shortcut icon" type="image/jpg" href="https://www.narolainfotech.com/wp-content/themes/narola-infotech/inc/img/favicon.png" width="16">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f7f9; /* Light background for contrast */
            color: #333; /* Default text color */
        }

        header {
            background: #35424a; /* Dark blue background */
            color: #ffffff;
            padding: 20px;
            display: flex;
            height:	 30px;
            align-items: center; /* Center items vertically */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .logo {
            width: 50px; /* Adjust logo size */
            height: auto;
            margin-right: 20px; /* Space between logo and header text */
        }

        .header-text {
            /*flex-grow: 0; !* Allows the text to fill the remaining space *!*/
        }

        .header-subtitle {
            color: #666; /* Gray color for subtitle */
            font-size: 1.2em; /* Slightly larger font size */
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            margin: 20px;
            gap: 20px;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 600px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            padding: 20px;
            transition: transform 0.2s;
            border: 1px solid #35424a; /* Border color matching header */
        }

        form:hover {
            transform: scale(1.02);
        }

        fieldset {
            border: none; /* Remove default border */
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            background: #f9f9f9; /* Light grey background for fieldset */
        }

        legend {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.3em; /* Larger font size for legend */
            color: #35424a; /* Header color */
        }

        label {
            font-weight: bold;
            color: #333;
            margin-top: 10px;
        }

        input[type="text"], input[type="file"], input[type="password"], input[type="number"], input[type="color"], textarea, select {
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 5px;
            transition: border-color 0.2s;
            font-size: 1em; /* Increased font size */
        }

        input[type="text"], input[type="file"], input[type="password"], input[type="number"], input[type="color"], textarea, select
        :focus {
            border-color: #35424a; /* Focus border color */
            outline: none;
        }

        .file-input {
            margin-top: 5px;
            font-size: 1em; /* Increased font size for file input */
        }

        button {
            padding: 12px;
            background-color: #a0cfea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2em;
            transition: background-color 0.3s, transform 0.2s;
        }

        button:hover {
            background-color: #647a87;
            transform: scale(1.05);
        }

        .hidden {
            display: none;
        }

        footer {
            background: #35424a; /* Match footer with header */
            color: white;
            text-align: center;
            padding: 10px;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
        }

        footer p {
            margin: 0;
            font-size: 0.9em;
        }

        .error-message {
            color: red;
            font-size: 0.9em;
            margin-top: -10px;
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                align-items: center;
            }

            header {
                flex-direction: column; /* Stack items vertically on small screens */
                align-items: flex-start; /* Align items to the start */
            }

            .header-text {
                text-align: left; /* Align text left on smaller screens */
            }

            form {
                width: 90%; /* Full width for mobile devices */
            }

            .instructions {
                background-color: #f9f9f9; /* Light background for instructions */
                border: 1px solid #ccc; /* Light border */
                border-radius: 8px; /* Rounded corners */
                padding: 20px; /* Padding around content */
                margin-top: 20px; /* Space above */
            }
        }
    </style>

    <script>
        function toggleInputSections() {
            const hsmSection = document.getElementById("hsmSection");
            const keystoreSection = document.getElementById("keystoreSection");
            const selectedOption = document.querySelector('input[name="signatureOption"]:checked');

            // Hide both sections if no option is selected
            if (!selectedOption) {
                hsmSection.classList.add("hidden");
                keystoreSection.classList.add("hidden");
                return;
            }

            // Show the appropriate section based on the selected option
            if (selectedOption.value === "hsm") {
                hsmSection.classList.remove("hidden");
                keystoreSection.classList.add("hidden");
            } else if (selectedOption.value === "keystore") {
                keystoreSection.classList.remove("hidden");
                hsmSection.classList.add("hidden");
            }
        }

        function validateForm(event) {
            const pdfFile = document.getElementById("pdfFile");
            const selectedOption = document.querySelector('input[name="signatureOption"]:checked');
            let valid = true;

            // Clear previous error messages
            document.querySelectorAll('.error-message').forEach(msg => msg.textContent = '');

            // Validate PDF file
            if (!pdfFile.value) {
                valid = false;
                document.getElementById("pdfFileError").textContent = "PDF file is required.";
            }

            // Validate selected option
            if (!selectedOption) {
                valid = false;
                document.getElementById("signatureOptionError").textContent = "Please select a signing method.";
            } else if (selectedOption.value === "hsm") {
                // HSM Validation
                const hsmFile = document.getElementById("hsmFile");
                const hsmSignatureText = document.getElementById("hsmSignatureText");
                if (!hsmFile.value) {
                    valid = false;
                    document.getElementById("hsmFileError").textContent = "HSM file is required.";
                }
                if (!hsmSignatureText.value) {
                    valid = false;
                    document.getElementById("hsmSignatureTextError").textContent = "HSM signature text is required.";
                }
            } else if (selectedOption.value === "keystore") {
                // Keystore Validation
                const keystoreFile = document.getElementById("keystoreFile");
                if (!keystoreFile.value) {
                    valid = false;
                    document.getElementById("keystoreFileError").textContent = "Keystore file is required.";
                }
                // Keystore signature text is optional, so no validation needed here
            }

            if (!valid) {
                event.preventDefault(); // Prevent form submission
            }
        }
    </script>
</head>
<body>
<header style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background-color: #35424a; color: white; position: relative;">
    <img src="https://www.narolainfotech.com/wp-content/uploads/2022/09/nisl-logo.svg"
         alt="Narola Logo"
         style="width: 110px; height: auto; <!--border-radius: 50%;-->">


    <!-- Hamburger Menu Icon -->
    <div id="hamburger" style="cursor: pointer;">
        <div style="width: 30px; height: 3px; background-color: white; margin: 5px;"></div>
        <div style="width: 30px; height: 3px; background-color: white; margin: 5px;"></div>
        <div style="width: 30px; height: 3px; background-color: white; margin: 5px;"></div>
    </div>

    <!-- Logout Menu -->
    <div id="menu"
         style="display: none; position: absolute; right: 20px; background-color: #35424a; padding: 10px; border-radius: 5px; box-shadow: 0 2px 10px rgba(0,0,0,0.2);">
        <a href="/profile" style="color: white; text-decoration: none; display: block; padding: 5px 10px;">Profile</a>
        <a href="/settings" style="color: white; text-decoration: none; display: block; padding: 5px 10px;">Settings</a>
        <a href="/help" style="color: white; text-decoration: none; display: block; padding: 5px 10px;">Help</a>
        <a href="/logout" style="color: white; text-decoration: none; display: block; padding: 5px 10px;">Logout</a>
    </div>
</header>

<script>
    document.getElementById('hamburger').onclick = function () {
        const menu = document.getElementById('menu');
        menu.style.display = menu.style.display === 'none' || menu.style.display === '' ? 'block' : 'none';
    };

    // Optional: Close the menu if clicking outside of it
    document.addEventListener('click', function (event) {
        const menu = document.getElementById('menu');
        const hamburger = document.getElementById('hamburger');
        if (!hamburger.contains(event.target) && !menu.contains(event.target)) {
            menu.style.display = 'none';
        }
    });
</script>

<div class="container">
    <div class="header-text">
        <h1>Document Signing</h1>
        <p class="header-subtitle">Securely sign your documents online</p>
        <div class="instructions">
            <h2>How to Sign Your Document/PDF</h2>
            <ol>
                <li><strong>Select the File:</strong> <br>
                    Click on the "Choose File" button to upload the PDF document you wish to sign.
                </li>
                <br>
                <li><strong>Select a Certificate:</strong><br>
                    Choose a certificate from the available options to apply your signature.
                </li>
                <br>
                <li><strong>Set Signature Details:</strong><br>
                    Enter the text that should appear with your visible signature.<br>
                    Make sure it is correct and reflects your intent.
                </li>
                <br>
                <li><strong>Submit:</strong><br>
                    Click the "Sign PDF" button to submit your request.<br>
                    The system will process your document.
                </li>
                <br>
                <li><strong>Receive Signed PDF:</strong><br>
                    After processing, you will receive the signed PDF in Base64 format.
                </li>
            </ol>
        </div>
    </div>
    <form th:action="@{/sign}" method="post" enctype="multipart/form-data" th:object="${signRequest}"
          onsubmit="validateForm(event)">
        <fieldset>
            <legend>File Uploads</legend>

            <label for="pdfFile">PDF File:</label>
            <input type="file" id="pdfFile" name="pdfFile" class="file-input" accept=".pdf" required>
            <div id="pdfFileError" class="error-message"></div>
        </fieldset>

        <fieldset>
            <legend>Select Signing Method</legend>
            <label>
                <input type="radio" name="signatureOption" value="hsm" onclick="toggleInputSections()" required>
                HSM
            </label>
            <label>
                <input type="radio" name="signatureOption" value="keystore" onclick="toggleInputSections()" required>
                Keystore
            </label>
            <div id="signatureOptionError" class="error-message"></div>
        </fieldset>

        <fieldset id="hsmSection" class="hidden">
            <legend>HSM Signature Details</legend>

            <label for="hsmFile">HSM File:</label>
            <input type="file" id="hsmFile" name="hsmFile" class="file-input" accept=".pem,.key" required>
            <div id="hsmFileError" class="error-message"></div>
            <br>
            <legend>HSM Signature Slot Details</legend>
            <label for="slotLabel">Slot label:</label>
            <input type="text" id="slotLabel" name="slotLabel" placeholder="Enter slot label">
            <br><br>
            <label for="slotPin">Slot Pin:</label>
            <input type="text" id="slotPin" name="slotPin" placeholder="Enter slot Pin">
            <br><br>
            <label for="slotSopin">Slot Sopin:</label>
            <input type="text" id="slotSopin" name="slotSopin" placeholder="Enter slot Sopin">
            <br><br>
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" placeholder="Enter hsm password">
            <br>
            <br>
            <!-- Visible Signature Information -->
            <legend>Visible Signature Information</legend>

            <!-- Visible Signature Image Upload -->
            <label for="HsmVisibleSignImage">Keystore Visible Image:</label>
            <input type="file" id="HsmVisibleSignImage" name="keystoreVisibleSignImage" class="file-input"
                   accept="image/*">
            <div id="HsmVisibleSignImage" class="error-message"></div>
            <br>
            <!-- Positioning of Visible Signature -->
            <label for="page">Page Number:</label>
            <input type="number" id="page" name="page" value="1" min="1">
            <br><br>
            <label for="x">X Position:</label>
            <input type="number" id="x" name="x" placeholder="X-coordinate">
            <br><br>
            <label for="y">Y Position:</label>
            <input type="number" id="y" name="y" placeholder="Y-coordinate">
            <br><br>
            <label for="rotate">Rotate:</label>
            <select id="rotate" name="rotate">
                <option value="none">None</option>
                <option value="90">90°</option>
                <option value="180">180°</option>
                <option value="270">270°</option>
            </select>
            <br><br>
            <!-- Alignment Options -->
            <label for="alignHorizontal">Horizontal Alignment:</label>
            <select id="alignHorizontal" name="alignHorizontal">
                <option value="left">Left</option>
                <option value="center">Center</option>
                <option value="right">Right</option>
            </select>
            <br><br>
            <label for="alignVertical">Vertical Alignment:</label>
            <select id="alignVertical" name="alignVertical">
                <option value="top">Top</option>
                <option value="middle">Middle</option>
                <option value="bottom">Bottom</option>
            </select>
            <br><br>
            <!-- Style Settings for Visible Signature Text -->
            <label for="keystoreSignatureText">Signature Text Content:</label>
            <textarea id="keystoreSignatureText" name="keystoreSignatureText"
                      placeholder="Enter text here"></textarea>
            <br><br>
            <label for="font">Font:</label>
            <input type="text" id="font" name="font" placeholder="Font family (e.g., Arial)">
            <br><br>
            <label for="fontSize">Font Size:</label>
            <input type="number" id="fontSize" name="fontSize" placeholder="Font size">
            <br><br>
            <label for="fontColor">Font Color:</label>
            <input type="color" id="fontColor" name="fontColor" value="#000000">
            <br><br>
            <!-- Background Style -->
            <label for="backgroundColor">Background Color:</label>
            <input type="color" id="backgroundColor" name="backgroundColor" value="#cccccc">
            <br><br>
        </fieldset>

        <fieldset id="keystoreSection" class="hidden">
            <legend>Keystore Signature Details</legend>
            <!-- Keystore File Upload -->
            <label for="keystoreFile">Keystore File:</label>
            <input type="file" id="keystoreFile" name="keystoreFile" class="file-input" accept=".p12">
            <div id="keystoreFileError" class="error-message"></div>
            <br>
            <!-- Keystore Type (Fixed as p12) -->
            <label for="type">Type:</label>
            <input type="text" id="type" name="type" value="p12" readonly>
            <br><br>
            <!-- Password Field -->
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" placeholder="Enter keystore password">
            <br>
            <br>
            <!-- Visible Signature Information -->
            <legend>Visible Signature Information</legend>

            <!-- Visible Signature Image Upload -->
            <label for="keystoreVisibleSignImage">Keystore Visible Image:</label>
            <input type="file" id="keystoreVisibleSignImage" name="keystoreVisibleSignImage" class="file-input"
                   accept="image/*">
            <div id="keystoreVisibleSignImageError" class="error-message"></div>
            <br>
            <!-- Positioning of Visible Signature -->
            <label for="page">Page Number:</label>
            <input type="number" id="page" name="page" value="1" min="1">
            <br><br>
            <label for="x">X Position:</label>
            <input type="number" id="x" name="x" placeholder="X-coordinate">
            <br><br>
            <label for="y">Y Position:</label>
            <input type="number" id="y" name="y" placeholder="Y-coordinate">
            <br><br>
            <label for="rotate">Rotate:</label>
            <select id="rotate" name="rotate">
                <option value="none">None</option>
                <option value="90">90°</option>
                <option value="180">180°</option>
                <option value="270">270°</option>
            </select>
            <br><br>
            <!-- Alignment Options -->
            <label for="alignHorizontal">Horizontal Alignment:</label>
            <select id="alignHorizontal" name="alignHorizontal">
                <option value="left">Left</option>
                <option value="center">Center</option>
                <option value="right">Right</option>
            </select>
            <br><br>
            <label for="alignVertical">Vertical Alignment:</label>
            <select id="alignVertical" name="alignVertical">
                <option value="top">Top</option>
                <option value="middle">Middle</option>
                <option value="bottom">Bottom</option>
            </select>
            <br><br>
            <!-- Style Settings for Visible Signature Text -->
            <label for="keystoreSignatureText">Signature Text Content:</label>
            <textarea id="keystoreSignatureText" name="keystoreSignatureText"
                      placeholder="Enter text here"></textarea>
            <br><br>
            <label for="font">Font:</label>
            <input type="text" id="font" name="font" placeholder="Font family (e.g., Arial)">
            <br><br>
            <label for="fontSize">Font Size:</label>
            <input type="number" id="fontSize" name="fontSize" placeholder="Font size">
            <br><br>
            <label for="fontColor">Font Color:</label>
            <input type="color" id="fontColor" name="fontColor" value="#000000">
            <br><br>
            <!-- Background Style -->
            <label for="backgroundColor">Background Color:</label>
            <input type="color" id="backgroundColor" name="backgroundColor" value="#cccccc">
            <br>
        </fieldset>

        <button type="submit">Sign Document</button>
    </form>
</div>

<footer>
    <p>&copy; 2024 Narola infotech. All rights reserved.</p>
</footer>
</body>
</html>
